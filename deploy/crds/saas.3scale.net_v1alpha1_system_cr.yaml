apiVersion: saas.3scale.net/v1alpha1
kind: System
metadata:
  name: example
spec:
  image:
    name: "quay.io/3scale/porta"
    tag: "nightly"
    pullPolicy: "Always"
  grafanaDashboard:
    label:
      key: "monitoring-key"
      value: "middleware"
  env:
    ampRelease: 2.7.1
    rails:
      env: production
      logLevel: info
      logToStdout: true
    sandboxProxyOpensslVerifyMode: VERIFY_NONE
    forceSSL: true
    sslCertDir: /etc/pki/tls/cert
    threescaleProviderPlan: enterprise
    threescaleSuperdomain: example.com
  secret:
    multitenantIngressTLS: wildcard-multitenant-certificate
    appVaultPath: secret/data/openshift/cluster-example/3scale/system-app
    backendListenerVaultPath: secret/data/openshift/cluster-example/3scale/system-backend-listener
    configVaultPath: secret/data/openshift/dev-eng-ocp/3sscale-saas/system-config
    databaseVaultPath: secret/data/openshift/cluster-example/3scale/system-database
    eventsHookVaultPath: secret/data/openshift/cluster-example/3scale/system-events-hook
    masterApicastVaultPath: secret/data/openshift/cluster-example/3scale/system-master-apicast
    memcachedVaultPath: secret/data/openshift/cluster-example/3scale/system-memcached
    multitenantAssetsS3VaultPath: secret/data/openshift/cluster-example/3scale/system-multitenant-assets-s3
    recaptchaVaultPath: secret/data/openshift/cluster-example/3scale/system-recaptcha
    redisVaultPath: secret/data/openshift/cluster-example/3scale/system-redis
    seedVaultPath: secret/data/openshift/cluster-example/3scale/system-seed
    smtpVaultPath: secret/data/openshift/cluster-example/3scale/system-smtp
  app:
    replicas: 2
    resources:
      requests:
        cpu: "200m"
        memory: "1Gi"
      limits:
        cpu: "400m"
        memory: "2Gi"
    livenessProbe:
      initialDelaySeconds: 30
      timeoutSeconds: 1
      periodSeconds: 10
      successThreshold: 1
      failureThreshold: 3
    readinessProbe:
      initialDelaySeconds: 30
      timeoutSeconds: 5
      periodSeconds: 10
      successThreshold: 1
      failureThreshold: 3
    pdb:
      enabled: true
      maxUnavailable: "1"
    hpa:
      enabled: true
      minReplicas: 3
      maxReplicas: 6
      resourceName: "cpu"
      resourceUtilization: 90
  sidekiq:
    replicas: 2
    resources:
      requests:
        cpu: "500m"
        memory: "1Gi"
      limits:
        cpu: "1"
        memory: "2Gi"
    livenessProbe:
      initialDelaySeconds: 10
      timeoutSeconds: 3
      periodSeconds: 15
      successThreshold: 1
      failureThreshold: 5
    readinessProbe:
      initialDelaySeconds: 10
      timeoutSeconds: 5
      periodSeconds: 30
      successThreshold: 1
      failureThreshold: 5
    pdb:
      enabled: false
      maxUnavailable: "1"
    hpa:
      enabled: false
      minReplicas: 2
      maxReplicas: 4
      resourceName: "cpu"
      resourceUtilization: 90
  sphinx:
    env:
      thinking:
        port: 9306
        bindAddress: "0.0.0.0"
        configFile: "/opt/sphinx/sphinx.conf"
        dbPath: "/opt/sphinx"
        pidFile: "/opt/sphinx/sphinx.pid"
      deltaIndexInterval: 5
      fullReindexInterval: 60
    resources:
      requests:
        cpu: "250m"
        memory: "4Gi"
      limits:
        cpu: "750m"
        memory: "5Gi"
      storage: "30Gi"
    livenessProbe:
      initialDelaySeconds: 60
      timeoutSeconds: 3
      periodSeconds: 15
      successThreshold: 1
      failureThreshold: 5
    readinessProbe:
      initialDelaySeconds: 60
      timeoutSeconds: 5
      periodSeconds: 30
      successThreshold: 1
      failureThreshold: 5
